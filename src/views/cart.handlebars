<h1>üõí Tu carrito</h1>

{{#if cart.products.length}}

<table border="1" cellpadding="8" cellspacing="0">
    <tr>
        <th>Producto</th>
        <th>Precio</th>
        <th>Cantidad</th>
        <th>Subtotal</th>
        <th>Acciones</th>
    </tr>

    {{#each cart.products}}
    <tr>
        <td>{{this.product.name}}</td>
        <td>${{this.product.price}}</td>

        <td>
            <input 
                type="number" 
                min="1" 
                value="{{this.quantity}}" 
                onchange="updateQuantity('{{this.product._id}}', this.value)"
            >
        </td>

        <td>
            ${{multiply this.product.price this.quantity}}
        </td>

        <td>
            <button onclick="removeProduct('{{this.product._id}}')">
                Eliminar
            </button>
        </td>
    </tr>
    {{/each}}

</table>

<h2>Total: ${{cartTotal cart.products}}</h2>

<button onclick="clearCart()">
    Vaciar carrito
</button>

{{else}}
<p>No hay productos en el carrito</p>
{{/if}}

<br>
<a href="/products">‚Üê Seguir comprando</a>


<script>
const cartId = "69a0ebe61d28490fdeb15620"; // ID DEL CARRITO EN USO 

async function updateQuantity(productId, quantity) {
    await fetch(`/api/carts/${cartId}/products/${productId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ quantity: Number(quantity) })
    });

    location.reload();
}

async function removeProduct(productId) {
    await fetch(`/api/carts/${cartId}/products/${productId}`, {
        method: "DELETE"
    });

    location.reload();
}

async function clearCart() {
    await fetch(`/api/carts/${cartId}`, {
        method: "DELETE"
    });

    alert("Carrito vaciado");
    location.reload();
}
</script>